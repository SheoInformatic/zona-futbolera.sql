DROP TABLE CLIENTE  CASCADE CONSTRAINTS;
DROP TABLE CATALOGO  CASCADE CONSTRAINTS;
DROP TABLE INVENTARIO CASCADE CONSTRAINTS;
DROP TABLE PROMOCION CASCADE CONSTRAINTS;
DROP TABLE PEDIDO CASCADE CONSTRAINTS;
DROP TABLE VENTA CASCADE CONSTRAINTS;

DROP SEQUENCE seq_cat;
DROP SEQUENCE seq_com;
DROP SEQUENCE seq_error;
DROP SEQUENCE seq_porc_com_annos;
 
-- creacion de objetos
CREATE SEQUENCE seq_cat;
CREATE SEQUENCE seq_com START WITH 80;
CREATE SEQUENCE seq_error;
CREATE SEQUENCE seq_porc_com_annos;

-----------------------
-- CLIENTE
-----------------------
CREATE TABLE CLIENTE
( id_cliente     NUMBER(10)   NOT NULL,
  dvrut_cli      VARCHAR2(1)  NOT NULL,
  appaterno_cli  VARCHAR2(20) NOT NULL,
  apmaterno_cli  VARCHAR2(20) NOT NULL,
  nombre_cli     VARCHAR2(40) NOT NULL,
  email_cli      VARCHAR2(80) NOT NULL,
  telefono_cli   VARCHAR2(15),
  fec_registro   DATE DEFAULT SYSDATE NOT NULL,
  CONSTRAINT PK_CLIENTE PRIMARY KEY (id_cliente)
);

-- 15 CLIENTES
INSERT INTO CLIENTE VALUES (1000,'K','PEREZ','ROJAS','ANA PEREZ','ana.perez@zf.cl','+56911111111','01/03/2024');
INSERT INTO CLIENTE VALUES (1001,'1','GONZALEZ','DIAZ','LUIS GONZALEZ','luis.gonzalez@zf.cl','+56922222222','02/03/2024');
INSERT INTO CLIENTE VALUES (1002,'9','SOTO','CASTRO','MARTA SOTO','marta.soto@zf.cl','+56923333333','03/03/2024');
INSERT INTO CLIENTE VALUES (1003,'7','RAMIREZ','TORRES','CARLOS RAMIREZ','c.ramirez@zf.cl','+56924444444','04/03/2024');
INSERT INTO CLIENTE VALUES (1004,'8','HERNANDEZ','SALAS','VALERIA HERNANDEZ','v.hernandez@zf.cl','+56925555555','05/03/2024');
INSERT INTO CLIENTE VALUES (1005,'2','FERNANDEZ','ARAYA','DIEGO FERNANDEZ','d.fernandez@zf.cl','+56926666666','06/03/2024');
INSERT INTO CLIENTE VALUES (1006,'4','RIVERA','PARRA','NATALIA RIVERA','n.rivera@zf.cl','+56927777777','07/03/2024');
INSERT INTO CLIENTE VALUES (1007,'5','VEGA','FLORES','RODRIGO VEGA','r.vega@zf.cl','+56928888888','08/03/2024');
INSERT INTO CLIENTE VALUES (1008,'6','JARA','REYES','CONSTANZA JARA','c.jara@zf.cl','+56929999999','09/03/2024');
INSERT INTO CLIENTE VALUES (1009,'3','LOPEZ','VERA','SOFIA LOPEZ','s.lopez@zf.cl','+56930000000','10/03/2024');
INSERT INTO CLIENTE VALUES (1010,'0','SALAS','MORALES','IGNACIO SALAS','i.salas@zf.cl','+56930000001','11/03/2024');
INSERT INTO CLIENTE VALUES (1011,'K','ESCOBAR','FIGUEROA','MATIAS ESCOBAR','m.escobar@zf.cl','+56930000002','12/03/2024');
INSERT INTO CLIENTE VALUES (1012,'8','PAREDES','ORTEGA','KAREN PAREDES','k.paredes@zf.cl','+56930000003','13/03/2024');
INSERT INTO CLIENTE VALUES (1013,'5','CASTILLO','CAMPOS','DANIELA CASTILLO','d.castillo@zf.cl','+56930000004','14/03/2024');
INSERT INTO CLIENTE VALUES (1014,'2','MUNOZ','GARCES','JAVIER MUNOZ','j.munoz@zf.cl','+56930000005','15/03/2024');

-----------------------
-- CATALOGO (PRODUCTOS)
-----------------------
CREATE TABLE CATALOGO
( id_producto   NUMBER(10)   NOT NULL,
  nombre_prod   VARCHAR2(60) NOT NULL,
  categoria     VARCHAR2(30) NOT NULL,
  marca         VARCHAR2(30) NOT NULL,
  talla         VARCHAR2(10),
  precio        NUMBER(10,2) NOT NULL,
  activo        CHAR(1) DEFAULT 'S' CHECK (activo IN ('S','N')),
  CONSTRAINT PK_CATALOGO PRIMARY KEY (id_producto)
);

INSERT INTO CATALOGO VALUES (1,'POLERA OFICIAL 2024','POLERAS','ADIDAS','M',19990,'S');
INSERT INTO CATALOGO VALUES (2,'POLERA TRAINING','POLERAS','NIKE','L',17990,'S');
INSERT INTO CATALOGO VALUES (3,'BOTIN COURT','BOTINES','PUMA','41',49990,'S');
INSERT INTO CATALOGO VALUES (4,'BOTIN PRO TURF','BOTINES','NIKE','42',59990,'S');
INSERT INTO CATALOGO VALUES (5,'BALON MATCH','BALONES','ADIDAS','UN',24990,'S');
INSERT INTO CATALOGO VALUES (6,'BALON STREET','BALONES','UHLSPORT','UN',14990,'S');
INSERT INTO CATALOGO VALUES (7,'SHORT DRY','SHORTS','ADIDAS','M',12990,'S');
INSERT INTO CATALOGO VALUES (8,'MEDIAS COMP','ACCESORIOS','NIKE','L',6990,'S');
INSERT INTO CATALOGO VALUES (9,'POLERA GOALKEEPER','POLERAS','PUMA','S',22990,'S');
INSERT INTO CATALOGO VALUES (10,'MOCHILA TEAM','ACCESORIOS','ADIDAS','UN',19990,'S');
INSERT INTO CATALOGO VALUES (11,'CHAQUETA LIGERA','CHAQUETAS','NIKE','M',34990,'S');
INSERT INTO CATALOGO VALUES (12,'PETO ENTRENAMIENTO','ACCESORIOS','ADIDAS','UN',5990,'S');
INSERT INTO CATALOGO VALUES (13,'BOTIN ELITE FG','BOTINES','PUMA','43',79990,'S');
INSERT INTO CATALOGO VALUES (14,'BALON PRO','BALONES','NIKE','UN',34990,'S');
INSERT INTO CATALOGO VALUES (15,'CONEJERA','ACCESORIOS','UHLSPORT','UN',3990,'S');

-----------------------
-- INVENTARIO
-----------------------
CREATE TABLE INVENTARIO
( id_inventario    NUMBER(10) NOT NULL,
  id_producto      NUMBER(10) NOT NULL,
  stock            NUMBER(6)  NOT NULL,
  stock_minimo     NUMBER(6)  NOT NULL,
  ubicacion        VARCHAR2(20),
  fecha_actualizacion DATE DEFAULT SYSDATE NOT NULL,
  CONSTRAINT PK_INVENTARIO PRIMARY KEY (id_inventario),
  CONSTRAINT FK_INV_PRODUCTO FOREIGN KEY (id_producto)
    REFERENCES CATALOGO(id_producto)
);

INSERT INTO INVENTARIO VALUES (1, 1, 30,10,'A-01','01/06/2024');
INSERT INTO INVENTARIO VALUES (2, 2, 25,10,'A-02','01/06/2024');
INSERT INTO INVENTARIO VALUES (3, 3, 12, 5,'B-01','01/06/2024');
INSERT INTO INVENTARIO VALUES (4, 4,  8, 5,'B-02','01/06/2024');
INSERT INTO INVENTARIO VALUES (5, 5, 40,15,'C-01','01/06/2024');
INSERT INTO INVENTARIO VALUES (6, 6, 35,10,'C-02','01/06/2024');
INSERT INTO INVENTARIO VALUES (7, 7, 20, 8,'D-01','01/06/2024');
INSERT INTO INVENTARIO VALUES (8, 8, 50,15,'D-02','01/06/2024');
INSERT INTO INVENTARIO VALUES (9, 9, 18, 6,'E-01','01/06/2024');
INSERT INTO INVENTARIO VALUES (10,10,16, 6,'E-02','01/06/2024');
INSERT INTO INVENTARIO VALUES (11,11,22, 8,'F-01','01/06/2024');
INSERT INTO INVENTARIO VALUES (12,12,60,20,'F-02','01/06/2024');
INSERT INTO INVENTARIO VALUES (13,13,10, 5,'G-01','01/06/2024');
INSERT INTO INVENTARIO VALUES (14,14,28,10,'G-02','01/06/2024');
INSERT INTO INVENTARIO VALUES (15,15,90,30,'H-01','01/06/2024');

-----------------------
-- PROMOCION
-----------------------
CREATE TABLE PROMOCION
( id_promocion   NUMBER(10)   NOT NULL,
  codigo         VARCHAR2(20) NOT NULL,
  descripcion    VARCHAR2(100),
  tipo           VARCHAR2(10) NOT NULL CHECK (tipo IN ('PCT','FIJO')),
  valor          NUMBER(10,2) NOT NULL,
  fecha_inicio   DATE NOT NULL,
  fecha_fin      DATE NOT NULL,
  activo         CHAR(1) DEFAULT 'S' CHECK (activo IN ('S','N')),
  CONSTRAINT PK_PROMOCION PRIMARY KEY (id_promocion)
);

INSERT INTO PROMOCION VALUES (1,'PROMO10','10% en poleras','PCT',10,'01/06/2024','31/12/2024','S');
INSERT INTO PROMOCION VALUES (2,'ENVIO0','EnvÃ­o gratis','FIJO',2990,'01/06/2024','31/12/2024','S');
INSERT INTO PROMOCION VALUES (3,'MATCH5K','$5.000 en balones','FIJO',5000,'01/06/2024','30/09/2024','S');
INSERT INTO PROMOCION VALUES (4,'VIP15','15% clientes VIP','PCT',15,'01/07/2024','31/12/2024','S');
INSERT INTO PROMOCION VALUES (5,'BACK2SCHOOL','Accesorios -$2.000','FIJO',2000,'01/02/2024','31/03/2024','N');
INSERT INTO PROMOCION VALUES (6,'WINTER7','7% general','PCT',7,'15/06/2024','31/08/2024','S');
INSERT INTO PROMOCION VALUES (7,'BOTIN20','20% en botines','PCT',20,'01/06/2024','31/07/2024','N');
INSERT INTO PROMOCION VALUES (8,'POLERA2K','-$2.000 poleras','FIJO',2000,'01/06/2024','31/12/2024','S');
INSERT INTO PROMOCION VALUES (9,'FINAL5','5% fin de mes','PCT',5,'25/06/2024','30/06/2024','N');
INSERT INTO PROMOCION VALUES (10,'SPRING10','10% primavera','PCT',10,'01/09/2024','30/11/2024','S');
INSERT INTO PROMOCION VALUES (11,'WEEKEND3','3% fin de semana','PCT',3,'01/06/2024','31/12/2024','S');
INSERT INTO PROMOCION VALUES (12,'ACC1K','-$1.000 accesorios','FIJO',1000,'01/06/2024','31/12/2024','S');
INSERT INTO PROMOCION VALUES (13,'FLASH25','25% flash','PCT',25,'15/06/2024','20/06/2024','N');
INSERT INTO PROMOCION VALUES (14,'BOTA5K','-$5.000 botines','FIJO',5000,'01/06/2024','31/07/2024','N');
INSERT INTO PROMOCION VALUES (15,'GOLD12','12% gold','PCT',12,'01/06/2024','31/12/2024','S');

-----------------------
-- PEDIDO (CABECERA)
-----------------------
CREATE TABLE PEDIDO
( id_pedido      NUMBER(10)   NOT NULL,
  id_cliente     NUMBER(10)   NOT NULL,
  fecha_pedido   DATE         NOT NULL,
  estado         VARCHAR2(20) NOT NULL CHECK (estado IN ('PENDIENTE','PAGADO','ENVIADO','CANCELADO')),
  subtotal       NUMBER(12,2) NOT NULL,
  impuesto       NUMBER(12,2) NOT NULL,
  envio          NUMBER(12,2) NOT NULL,
  descuento      NUMBER(12,2) NOT NULL,
  total_estimado NUMBER(12,2) NOT NULL,
  id_promocion   NUMBER(10),
  CONSTRAINT PK_PEDIDO PRIMARY KEY (id_pedido),
  CONSTRAINT FK_PEDIDO_CLIENTE FOREIGN KEY (id_cliente) REFERENCES CLIENTE(id_cliente),
  CONSTRAINT FK_PEDIDO_PROMO   FOREIGN KEY (id_promocion) REFERENCES PROMOCION(id_promocion)
);

-- 15 PEDIDOS (valores ya calculados para el ejemplo)
INSERT INTO PEDIDO VALUES (1 ,1000,'20/06/2024','PENDIENTE',19990,3798,2990,1999,24779,1);
INSERT INTO PEDIDO VALUES (2 ,1001,'20/06/2024','PENDIENTE',49990,9498,2990,0   ,62478,6);
INSERT INTO PEDIDO VALUES (3 ,1002,'21/06/2024','PENDIENTE',24990,4748,2990,5000,27728,3);
INSERT INTO PEDIDO VALUES (4 ,1003,'21/06/2024','PENDIENTE',59990,11398,2990,0   ,74378,7); -- promo inactiva -> sin descuento
INSERT INTO PEDIDO VALUES (5 ,1004,'22/06/2024','PENDIENTE',14990,2848,0   ,0   ,17838,6);
INSERT INTO PEDIDO VALUES (6 ,1005,'22/06/2024','PENDIENTE',12990,2468,2990,0   ,18448,6);
INSERT INTO PEDIDO VALUES (7 ,1006,'23/06/2024','PENDIENTE',22990,4368,2990,2000,28348,8);
INSERT INTO PEDIDO VALUES (8 ,1007,'23/06/2024','PENDIENTE', 6990,1328,2990,0   ,11308,2);
INSERT INTO PEDIDO VALUES (9 ,1008,'24/06/2024','PENDIENTE',19990,3798,2990,1999,24779,1);
INSERT INTO PEDIDO VALUES (10,1009,'24/06/2024','PENDIENTE',49990,9498,2990,0   ,62478,6);
INSERT INTO PEDIDO VALUES (11,1010,'25/06/2024','PENDIENTE',34990,6648,2990,10497,34131,1); -- 10% de 34990 = 3499 -> descuento 3499
UPDATE PEDIDO SET descuento=3499,total_estimado=34990+6648+2990-3499 WHERE id_pedido=11;
INSERT INTO PEDIDO VALUES (12,1011,'25/06/2024','PENDIENTE',22990,4368,0   ,0   ,27358,11);
INSERT INTO PEDIDO VALUES (13,1012,'26/06/2024','PENDIENTE',79990,15198,2990,0   ,98178,6);
INSERT INTO PEDIDO VALUES (14,1013,'26/06/2024','PENDIENTE',34990,6648,2990,2000,42628,12);
INSERT INTO PEDIDO VALUES (15,1014,'27/06/2024','PENDIENTE',14990,2848,2990,1000,19828,12);

-----------------------
-- VENTA (CIERRE DE PEDIDO)
-----------------------
CREATE TABLE VENTA
( id_venta      NUMBER(10)   NOT NULL,
  id_pedido     NUMBER(10)   NOT NULL,
  fecha_venta   DATE         NOT NULL,
  total_pagado  NUMBER(12,2) NOT NULL,
  medio_pago    VARCHAR2(20) NOT NULL CHECK (medio_pago IN ('TARJETA','TRANSFER','EFECTIVO','WEBPAY')),
  estado_pago   VARCHAR2(20) NOT NULL CHECK (estado_pago IN ('APROBADO','RECHAZADO','PENDIENTE')),
  nro_boleta    VARCHAR2(30),
  CONSTRAINT PK_VENTA PRIMARY KEY (id_venta),
  CONSTRAINT UQ_VENTA_PEDIDO UNIQUE (id_pedido),
  CONSTRAINT FK_VENTA_PEDIDO FOREIGN KEY (id_pedido) REFERENCES PEDIDO(id_pedido)
);

-- 15 VENTAS (algunas corresponden a pedidos anteriores)
INSERT INTO VENTA VALUES (1 ,1 ,'25/06/2024',24779,'WEBPAY' ,'APROBADO','B202406250001');
INSERT INTO VENTA VALUES (2 ,2 ,'25/06/2024',62478,'TARJETA','APROBADO','B202406250002');
INSERT INTO VENTA VALUES (3 ,3 ,'26/06/2024',27728,'TRANSFER','APROBADO','B202406260001');
INSERT INTO VENTA VALUES (4 ,5 ,'26/06/2024',17838,'EFECTIVO','APROBADO','B202406260002');
INSERT INTO VENTA VALUES (5 ,6 ,'27/06/2024',18448,'WEBPAY' ,'APROBADO','B202406270001');
INSERT INTO VENTA VALUES (6 ,8 ,'27/06/2024',11308,'TARJETA','APROBADO','B202406270002');
INSERT INTO VENTA VALUES (7 ,9 ,'28/06/2024',24779,'WEBPAY' ,'APROBADO','B202406280001');
INSERT INTO VENTA VALUES (8 ,10,'28/06/2024',62478,'TARJETA','APROBADO','B202406280002');
INSERT INTO VENTA VALUES (9 ,11,'29/06/2024',34131,'TRANSFER','APROBADO','B202406290001');
INSERT INTO VENTA VALUES (10,12,'29/06/2024',27358,'EFECTIVO','APROBADO','B202406290002');
INSERT INTO VENTA VALUES (11,13,'30/06/2024',98178,'WEBPAY' ,'APROBADO','B202406300001');
INSERT INTO VENTA VALUES (12,14,'30/06/2024',42628,'TARJETA','APROBADO','B202406300002');
INSERT INTO VENTA VALUES (13,15,'01/07/2024',19828,'TRANSFER','APROBADO','B202407010001');
INSERT INTO VENTA VALUES (14,4 ,'01/07/2024',74378,'WEBPAY' ,'APROBADO','B202407010002');
INSERT INTO VENTA VALUES (15,7 ,'02/07/2024',28348,'EFECTIVO','APROBADO','B202407020001');

COMMIT;
